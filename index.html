<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Plugin Manager</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #222; color: #ccc; padding: 0; margin: 0; }

        .container { max-width: 900px; margin: 30px auto; background: #2d2d2d; padding: 20px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs { display: flex; border-bottom: 2px solid #444; margin-bottom: 20px; }
        .tab-btn {
            background: none; border: none; padding: 10px 20px; color: #888;
            cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s;
        }
        .tab-btn:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .tab-btn.active { color: #007bff; border-bottom: 2px solid #007bff; margin-bottom: -2px; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* –¢–∞–±–ª–∏—Ü–∞ */
        table { width: 100%; border-collapse: collapse; background: #333; table-layout: fixed; }
        th, td { padding: 12px; border: 1px solid #444; text-align: left; }
        th { background: #3a3a3a; color: #fff; }

        /* –ö–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—ã */
        th:nth-child(1) { width: 15%; } /* –ö–æ–º–∞–Ω–¥–∞ */
        th:nth-child(2) { width: 45%; } /* –û–ø–∏—Å–∞–Ω–∏–µ */
        th:nth-child(3) { width: 10%; } /* –°—Ç–∞—Ç—É—Å */
        th:nth-child(4) { width: 30%; } /* –î–µ–π—Å—Ç–≤–∏—è */

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { padding: 6px 12px; cursor: pointer; border: none; color: white; border-radius: 4px; margin-right: 5px; font-size: 14px; }
        .btn-load { background: #28a745; }
        .btn-load:hover { background: #218838; }
        .btn-unload { background: #ffc107; color: #000; }
        .btn-unload:hover { background: #e0a800; }
        .btn-del { background: #dc3545; }
        .btn-del:hover { background: #c82333; }
        .btn-compile { background: #007bff; padding: 10px 20px; font-size: 16px; margin-top: 10px; }
        .btn-compile:hover { background: #0056b3; }

        /* –°—Ç–∞—Ç—É—Å—ã */
        .status-active { color: #28a745; font-weight: bold; }
        .status-inactive { color: #888; font-style: italic; }

        /* –†–µ–¥–∞–∫—Ç–æ—Ä */
        textarea {
            width: 100%; height: 300px;
            background: #1e1e1e; color: #d4d4d4;
            border: 1px solid #444; font-family: monospace;
            padding: 10px; box-sizing: border-box;
            border-radius: 4px;
        }

        #global-status {
            min-height: 20px; margin-bottom: 15px; font-family: monospace; color: #aaa;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>–°–µ—Ä–≤–µ—Ä —á–∞—Ç–∞: –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
    <div id="global-status"></div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('create')">üìù –°–æ–∑–¥–∞—Ç—å (–ö–æ–º–ø–∏–ª—è—Ü–∏—è)</button>
        <button class="tab-btn" onclick="openTab('manage')">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞–º–∏</button>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ -->
    <div id="create" class="tab-content active">
        <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ C++ –Ω–∏–∂–µ. –ù–µ –∑–∞–±—É–¥—å—Ç–µ —É–∫–∞–∑–∞—Ç—å <code>get_name</code> –∏ <code>get_description</code>.</p>
        <textarea id="code" spellcheck="false">
#include "api.h"
#include <string>

// –ò–º—è –∫–æ–º–∞–Ω–¥—ã (–±–µ–∑ #)
extern "C" EXPORT const char* get_name() {
    return "test";
}

// –û–ø–∏—Å–∞–Ω–∏–µ
extern "C" EXPORT const char* get_description() {
    return "–¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω";
}

// –õ–æ–≥–∏–∫–∞
extern "C" EXPORT const char* handle_message(const char* sender, const char* text) {
    return "–ü–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç!";
}
        </textarea>
        <button class="btn btn-compile" onclick="compile()">–°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div id="manage" class="tab-content">
        <button onclick="loadList()" class="btn" style="background:#555; margin-bottom:10px;">‚Üª –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <table>
            <thead>
            <tr>
                <!-- –°–¢–û–õ–ë–ï–¶ "–§–ê–ô–õ" –£–î–ê–õ–ï–ù -->
                <th>–ö–æ–º–∞–Ω–¥–∞</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody id="list"></tbody>
        </table>
    </div>
</div>

<script>
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

        document.getElementById(tabName).classList.add('active');

        const btns = document.querySelectorAll('.tab-btn');
        if (tabName === 'create') btns[0].classList.add('active');
        if (tabName === 'manage') {
            btns[1].classList.add('active');
            loadList();
        }
    }

    function loadList() {
        const list = document.getElementById('list');
        list.innerHTML = '<tr><td colspan="4" style="text-align:center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';

        fetch('/list').then(r => r.json()).then(data => {
            list.innerHTML = "";
            if (data.length === 0) {
                list.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#777;">–ù–µ—Ç –ø–ª–∞–≥–∏–Ω–æ–≤</td></tr>';
                return;
            }

            data.forEach(p => {
                let actions = "";

                // –ú—ã –≤—Å—ë –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º p.filename –¥–ª—è –ª–æ–≥–∏–∫–∏ –∫–Ω–æ–ø–æ–∫, –Ω–æ –Ω–µ –≤—ã–≤–æ–¥–∏–º –µ–≥–æ –≤ —Ç–∞–±–ª–∏—Ü—É
                if (p.status === 'active') {
                    actions += `<button class="btn btn-unload" onclick="doAction('unload', '${p.filename}', '${p.cmd}')">–í—ã–∫–ª</button>`;
                    actions += `<button class="btn btn-del" onclick="doAction('delete', '${p.filename}', '${p.cmd}')">–£–¥–∞–ª–∏—Ç—å</button>`;
                } else {
                    actions += `<button class="btn btn-load" onclick="doAction('load', '${p.filename}', '')">–í–∫–ª</button>`;
                    actions += `<button class="btn btn-del" onclick="doAction('delete', '${p.filename}', '')">–£–¥–∞–ª–∏—Ç—å</button>`;
                }

                const cmdDisplay = p.cmd ? `<span style="font-weight:bold; color:#fff">#${p.cmd}</span>` : `<span style="color:#777">(–ù–µ—Ç –∫–æ–º–∞–Ω–¥—ã)</span>`;

                // –£–±—Ä–∞–Ω–∞ —è—á–µ–π–∫–∞ —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞
                const row = `<tr>
                    <td>${cmdDisplay}</td>
                    <td>${p.desc}</td>
                    <td class="status-${p.status}">${p.status.toUpperCase()}</td>
                    <td>${actions}</td>
                </tr>`;
                list.innerHTML += row;
            });
        }).catch(err => {
            list.innerHTML = '<tr><td colspan="4" style="color:red">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</td></tr>';
        });
    }

    function doAction(action, filename, cmd) {
        if(action === 'delete' && !confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω –Ω–∞–≤—Å–µ–≥–¥–∞?')) return;

        fetch('/manage', {
            method: 'POST',
            body: `action=${action}&file=${encodeURIComponent(filename)}&cmd=${encodeURIComponent(cmd)}`
        }).then(r => r.text()).then(msg => {
            document.getElementById('global-status').innerText = msg;
            loadList();
        });
    }

    function compile() {
        const code = document.getElementById('code').value;
        const fname = "plugin_" + Date.now();
        const statusDiv = document.getElementById('global-status');

        statusDiv.innerText = "–ö–æ–º–ø–∏–ª—è—Ü–∏—è...";

        fetch('/compile', {
            method:'POST',
            body:`filename=${fname}&code=${encodeURIComponent(code)}`
        })
            .then(r => r.text())
            .then(msg => {
                statusDiv.innerText = msg;
                if (msg.includes("Success") || msg.includes("—É—Å–ø–µ—à–Ω–æ")) {
                    statusDiv.style.color = "#28a745";
                } else {
                    statusDiv.style.color = "#dc3545";
                }
            })
            .catch(e => {
                statusDiv.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
                statusDiv.style.color = "#dc3545";
            });
    }
</script>

</body>
</html>